<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Kadie AI â€¢ Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <link rel="stylesheet" href="/assets/main.css" />
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3366084057758708" crossorigin="anonymous"></script>
  <style>
    :root{ --header-h:72px; --banner-h:0px; --gap-y:0px; }
    html,body{height:100%; margin:0}

    #siteHeader{position:sticky; top:0; z-index:100; background:#0b0b0c; border-bottom:1px solid #151923;}
    .header{display:flex;align-items:center;justify-content:space-between;padding:12px 0;gap:12px}
    .left{display:flex;align-items:center;gap:14px}

    .brand-title{margin:0;font-weight:800;font-size:20px;color:#eaeaea;line-height:1}
    .brand-title a{color:inherit;text-decoration:none;cursor:pointer}

    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab-btn{border:1px solid #2b2f3a;background:#11131a;color:#eaeaea;padding:8px 12px;border-radius:10px;cursor:pointer;text-decoration:none}
    .tab-btn[hidden]{display:none}
    .tab-btn.active{outline:2px solid #5ac8fa}
    .tab-btn.primary{background:#0e2238;border-color:#1e3a8a;color:#dbeafe}
    .tab-btn.primary.active{outline:2px solid #60a5fa}
    .tab-btn.upgrade{background:#2a0e12;border-color:#5f1a20;color:#ffd7d7;font-weight:700}
    .tab-btn.upgrade:hover{background:#47141b}

    .server-badge{display:none;background:#0b0b0c;border-bottom:1px solid #151923;}
    .server-badge.show{display:block}
    .server-badge > .container{display:flex;align-items:center;gap:10px;padding:8px 12px}
    .server-ico{width:20px;height:20px;border-radius:6px;background:#0002;object-fit:cover}
    .server-title{display:flex;align-items:baseline;gap:8px;min-width:0}
    .server-name{font-weight:700;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:46vw}
    .server-id{font-size:12px;color:#9aa4b2}
    /* shrink spacer so CPU can take the space */
    .server-spacer{flex:0 0 8px}
    .leave-btn{border:1px solid #3a1f1f;background:#1a1111;color:#fca5a5;padding:4px 8px;border-radius:8px;cursor:pointer;font-size:12px}

    /* CPU progress bar */
    .cpu{display:flex;align-items:center;gap:8px;min-width:160px;flex:1 1 auto;max-width:none}
    .cpu-bar{position:relative;height:10px;flex:1 1 auto;border-radius:999px;background:#0f1117;border:1px solid #22293a;overflow:hidden}
    /* critical: control width via JS; do NOT pin right */
    .cpu-fill{position:absolute;left:0;top:0;bottom:0;width:0%;background:linear-gradient(90deg,#1e40af,#60a5fa);filter:drop-shadow(0 0 6px #60a5fa55)}
    /* keep label tight to bar */
    .cpu-meta{font-size:12px;color:#9aa4b2;white-space:nowrap;min-width:auto;text-align:left}

    .full-bleed{width:100vw;margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw)}
    .viewport-wrap{position:relative;height:calc(100dvh - var(--header-h) - var(--banner-h) - var(--gap-y));}
    .content{position:absolute;inset:0;border:0;overflow:hidden;background:#0b0b0c}
    .frame{position:absolute;inset:0;width:100%;height:100%;border:0;display:none}
    .frame.active{display:block}

    .auth-block{position:absolute;inset:0;background:linear-gradient(160deg,#0b0f1a,#0f1324);display:none;align-items:center;justify-content:center;z-index:50}
    .auth-card{background:#0e1116;border:1px solid #2b2f3a;border-radius:12px;padding:18px;max-width:420px;box-shadow:0 10px 24px #000a}
    .auth-block.show{display:flex}
    .btn{border:1px solid #2b2f3a;background:#111;color:#eee;padding:8px 12px;border-radius:10px;cursor:pointer}
    .muted{color:#9aa4b2;font-size:12px}
    @media (max-width: 1100px){ .header{flex-wrap:wrap} }
  </style>
</head>
<body>
  <header id="siteHeader">
    <div class="container header">
      <div class="left">
        <h1 class="brand-title">
          <a id="brandHome" href="/kadie-ai/kadie-cover.html" aria-label="Back to cover">Kadie AI</a>
        </h1>
      </div>

      <nav class="tabs" id="tabs" aria-label="Workspace">
        <button class="tab-btn active" data-tab="simple"     id="tab-simple">Simple Server</button>
        <button class="tab-btn primary" data-tab="blueprints" id="tab-blueprints" hidden>Blueprints</button>
        <button class="tab-btn"        data-tab="community"  id="tab-community" hidden>Community</button>
        <button class="tab-btn"        data-tab="nodes"      id="tab-nodes">Nodes</button>
        <button class="tab-btn"        data-tab="status"     id="tab-status">Status</button>
      </nav>
    </div>
  </header>

  <div id="serverBadge" class="server-badge" aria-live="polite">
    <div class="container">
      <img id="sbIcon" class="server-ico" alt="">
      <div class="server-title">
        <span id="sbName" class="server-name"></span>
        <span id="sbId" class="server-id"></span>
      </div>

      <div class="server-spacer"></div>

      <!-- CPU usage progress bar (shows only MAX text) -->
      <div class="cpu" id="cpuSlot" title="0/0" aria-label="CPU usage">
        <div class="cpu-bar"><div class="cpu-fill" id="cpuFill" style="width:0%"></div></div>
        <div class="cpu-meta" id="cpuMax">0</div>
      </div>

      <button id="leaveServerBtn" class="leave-btn" title="Leave server">Leave</button>
    </div>
  </div>

  <main class="viewport-wrap full-bleed">
    <div class="content" id="content">
      <iframe id="frame-simple"     class="frame active" src="/kadie-ai/server-listings.html"      title="Server listings"></iframe>
      <iframe id="frame-blueprints" class="frame"        src="about:blank"                         title="Blueprints"></iframe>
      <iframe id="frame-community"  class="frame"        src="/kadie-ai/community-forums.html"     title="Community"></iframe>
      <iframe id="frame-nodes"      class="frame"        src="/kadie-ai/nodes-docs.html"           title="Nodes"></iframe>
      <iframe id="frame-status"     class="frame"        src="/kadie-ai/bot-status.html"           title="Status"></iframe>

      <div class="auth-block" id="authBlock" aria-live="polite">
        <div class="auth-card">
          <h3 style="margin:0 0 8px 0">Sign in required</h3>
          <p id="authStatus" class="muted" style="margin:0 0 12px 0">Please sign in to access this section.</p>
          <div style="display:flex;gap:10px;justify-content:flex-end">
            <button class="btn" id="signinDirect">Sign in with Discord</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script type="module" src="/kadie-ai/kadie-home.js"></script>

  <script type="module">
    function activateTab(tabId){
      document.querySelectorAll('.tab-btn').forEach(btn=>{
        const on = btn.dataset.tab === tabId;
        btn.classList.toggle('active', on);
      });
      document.querySelectorAll('.frame').forEach(fr=>{
        const on = fr.id === `frame-${tabId}`;
        fr.classList.toggle('active', on);
      });
    }

    window.addEventListener('message', (ev)=>{
      const d = ev?.data || {};
      if (d.type === 'kadie:open-node-docs'){
        activateTab('nodes');
        const frame = document.getElementById('frame-nodes');

        try{
          frame?.contentWindow?.postMessage({ type:'kadie:select-node', nodeId:String(d.nodeId||'') }, '*');
        }catch{}

        try{
          const src = frame.getAttribute('src') || '/kadie-ai/nodes-docs.html';
          const u = new URL(src, location.origin);
          u.pathname = '/kadie-ai/nodes-docs.html';
          u.searchParams.set('node', String(d.nodeId||''));
          const next = `${u.pathname}?${u.searchParams.toString()}`;
          if (frame.src !== next) frame.src = next;
        }catch{}
      }
    });
  </script>
</body>
</html>
